## 3.データ型と変数宣言
本章では，Stanの式でのデータ型について説明します。Stnで使われる全ての変数は，データ型を宣言されていなければなりません。その型の値だけ，変数に割り当てることができます(変数変換`transformed data`とパラメータ変換`transformed parameter`の一時的な状態は除きます)。これはC++言語のようなプログラミング言語の利便性をフォローしたもので，Pythonのようなスクリプト言語や，RやBUGSのような統計言語の書き方とは異なります。

強くて静的な型つけ(typing)についてのモチベーションは，三つあります。

+ 強い型つけはプログラマーが変数に宣言をつける意思を持たせ，プログラムの理解を簡単にし，デバッグや補修をしやすくします。

+ 強い型つけは宣言に関わるプログラミングエラーを見つけにくくする(実行時)というよりむしろ，見つけやすくする(コンパイルの時に)のです。Stanのコンパイラ(CmdStan, RStanやPyStanなどのインターフェイスを通じて呼び出されるもの)はあらゆる型のエラーを見つけ出し，プログラムがコンパイルされる時に式の違反を素早く指し示します。

+ 制限つきの型は実行時のデータ，初期化，媒介する時の値にエラーがあれば，実行を許して広がったり潜在的に結果を汚したりするようなことが生じさせずに，できるだけ素早くそれをキャッチします。

強い型つけは，プログラムの違う場所で，あるいは違うところから呼び出されるプログラムにおいて，違う型のオブジェクトに同じ値を与えることを許しません。

### 3.1 データ型の概要

組み込み，あるいはユーザー定義関数の引数や，ローカル変数は基本的なデータ型である必要があり，制限のないプリミティブ型，ベクトル型，行列型あるいはそれらの配列であることになります。

Stanで関数に引数を渡すことは，基本型にアサインするのと同じように機能します。Stanの関数は，配列の字数も含めてその引数の基本型のみ指定しますが，大きさや定数については指定がありません。もちろん，関数はその振る舞いのあちこちで制限をチェックします。


#### プリミティブ型
Stanには連続値に対応した`real`と、整数に対応した`int`の2種のプリミティブ型が用意されています。


#### `vector`, `matrix`型
Stanには列ベクトルに対応した`vector`, 行ベクトルに対応した`row_vector`, 行列に対応した`matrix`の3種の行列ベースのデータ型が用意されています。

#### 配列
添え字をつけて宣言することで、任意の型（次節で紹介する制約付き型も含む）を配列とすることができます。以下に具体例を示します。

```
real x[10];
matrix[3,3] m[6,7];
```

上記のように記述すると、`ｘ`は1次元で10個の実数が含まれた値として宣言することになります。`m`は同様に、3 × 3行列を6 × 7個並べた2次元配列を宣言したことになります。

#### 制約付きデータ型

ローカル変数以外の変数を宣言する際には、制約をつけても構いません。制約は変数に対するデータ型だけはなく，変数変換，パラメータ変換，生成量ブロック，パラメータブロックにおける制約されない空間から制約された空間への変換でもエラーチェックが行われます。

すべての基本データ型には，次のような構文を使って上限、下限を与えることができます。

```
int<lower=1> N;
real<upper=0> log_p;
vector<lower=-1,upper=1>[3,3] corr;
```

構造化されたベクトルや行列のための特別なデータ型もあります。ベクトルデータ型には四つの制約された型があります。`simplex`型は単一神父レックス，`unit_vector`型は単位長ベクトル，`ordered`型はスカラーの大きさの順番に並べられたベクトル，そして`positive_ordered`型は正のスカラーの大きさ順に並べられたベクトルです。特別な行列データ型として，`corr_matrix`と`cov_matrix`があり，それぞれ相関行列(対称で正定値で対角項が1)，共分散行列(対称で正定値)です。`cholesky_factor_cov`型は，共分散行列のコレスキー因子(下三角で対角項が正，自身の転置行列との積が共分散行列になる)です。`cholesky_factor_corr`型は相関行列のコレスキー因子(下三角で対角項が正，行が単位長)です。

`data`,`transformed data`,`transformed parameters`,`generated quantities`ブロックで定義される変数に対して，制約についてのエラーチェックが行われます。`parameters`ブロックにおける変数宣言について，制約は決定的で，そこで制約された変数(宣言された制約)から制約されない変数(全ての$\mathbb{R}$の範囲)への変換が決定づけられます。

制約されたデータ型の最も重要な側面について，声を上げておくことには意味があるでしょう。

> モデルは制約の宣言に当たるまではあらゆるパラメータ値(ゼロでない密度，無限の対数密度に等しいものでも)をサポートしなければならない。

宣言された制約を満たすパラメータ値が制約を破っても，無限の対数密度を持っていないのであれば，サンプラーや最適化ではあらゆるおかしなパス，つまり行き詰まったり，初期化に失敗したり，行き過ぎたメトロポリスの棄却，分布の裾を探索することができないことによるバイアスのかかったサンプルなどの可能性を持っているかもしれないのです。
